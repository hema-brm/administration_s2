{% extends '@base/app.html.twig' %}
{% from "@components/macros/content.html.twig" import header %}
{% from "@components/input/macros/index.html.twig" import form_search_macro %}

{% block title %}Rapport{% endblock %}

{% block body %}
    {{ header({
        text: 'Rapport',
    }) }}
    <form id="periodForm" action="{{ path('report') }}" method="GET">
        <select name="period" onchange="document.getElementById('periodForm').submit()">
            <option value="month" {% if app.request.query.get('period', 'month') == 'month' %}selected{% endif %}>Rapport du mois</option>
            <option value="year" {% if app.request.query.get('period', 'month') == 'year' %}selected{% endif %}>Rapport de l'année</option>
        </select>
    </form>
    <div class="flex shadow-md bg-gray-100 m-6 p-3 rounded-md">
       <div class="w-1/2">
           {{ render_chart(chart) }}
       </div>
       <div class="w-1/2">
           {{ render_chart(doughnutChart) }}
       </div>
    </div>
    
    <div class="shadow-md bg-gray-100 m-6 p-3 rounded-md">
        <h2>Ventes par produit (par mois)</h2>
        <table class="table-auto">
            <thead>
                <tr>
                    <th>Produit</th>
                    <th>Mois</th>
                    <th>Nombre de produits vendus</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for productSale in productSalesByMonth %}
                    <tr>
                        <td>{{ productSale.product.name }}</td>
                        <td>{{ productSale.month }}</td>
                        <td>{{ productSale.quantity }}</td>
                        <td>{{ productSale.total }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="shadow-md bg-gray-100 m-6 p-3 rounded-md">
        <h2>Ventes par produit (par année)</h2>
        <table class="table-auto">
            <thead>
                <tr>
                    <th>Produit</th>
                    <th>Année</th>
                    <th>Nombre de produits vendus</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for productSale in productSalesByYear %}
                    <tr>
                        <td>{{ productSale.product.name }}</td>
                        <td>{{ productSale.year }}</td>
                        <td>{{ productSale.quantity }}</td>
                        <td>{{ productSale.total }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}
